"use strict";
/**
 * API Firmware Lambda
 *
 * Handles host firmware management operations via Notehub API.
 * All endpoints are admin-only.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_secrets_manager_1 = require("@aws-sdk/client-secrets-manager");
const secretsClient = new client_secrets_manager_1.SecretsManagerClient({});
const NOTEHUB_PROJECT_UID = process.env.NOTEHUB_PROJECT_UID || '';
const NOTEHUB_SECRET_ARN = process.env.NOTEHUB_SECRET_ARN || '';
const headers = {
    'Content-Type': 'application/json',
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type,Authorization',
    'Access-Control-Allow-Methods': 'GET,POST,OPTIONS',
};
// Cache the token to avoid fetching on every request
let cachedToken = null;
async function getNotehubToken() {
    if (cachedToken) {
        return cachedToken;
    }
    const command = new client_secrets_manager_1.GetSecretValueCommand({ SecretId: NOTEHUB_SECRET_ARN });
    const response = await secretsClient.send(command);
    if (!response.SecretString) {
        throw new Error('Notehub API token not found in secret');
    }
    const secret = JSON.parse(response.SecretString);
    cachedToken = secret.token;
    if (!cachedToken) {
        throw new Error('Token field not found in secret');
    }
    return cachedToken;
}
function isAdmin(event) {
    try {
        const claims = event.requestContext?.authorizer?.jwt?.claims;
        if (!claims)
            return false;
        const groups = claims['cognito:groups'];
        if (Array.isArray(groups)) {
            return groups.includes('Admin');
        }
        if (typeof groups === 'string') {
            return groups === 'Admin' || groups.includes('Admin');
        }
        return false;
    }
    catch {
        return false;
    }
}
async function fetchNotehubApi(path, method = 'GET', body) {
    const token = await getNotehubToken();
    const options = {
        method,
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
        },
    };
    if (body && (method === 'POST' || method === 'PUT')) {
        options.body = JSON.stringify(body);
    }
    const response = await fetch(`https://api.notefile.net${path}`, options);
    if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`Notehub API error: ${response.status} ${response.statusText} - ${errorText}`);
    }
    // Handle empty responses (some POST endpoints return empty body)
    const text = await response.text();
    if (!text) {
        return {};
    }
    return JSON.parse(text);
}
async function getHostFirmware() {
    const result = await fetchNotehubApi(`/v1/projects/${NOTEHUB_PROJECT_UID}/firmware?firmwareType=host`);
    return result || [];
}
async function queueFirmwareUpdate(filename, fleetUID, deviceUID) {
    let path = `/v1/projects/${NOTEHUB_PROJECT_UID}/dfu/host/update`;
    const queryParams = [];
    if (fleetUID) {
        queryParams.push(`fleetUID=${encodeURIComponent(fleetUID)}`);
    }
    if (deviceUID) {
        queryParams.push(`deviceUID=${encodeURIComponent(deviceUID)}`);
    }
    if (queryParams.length > 0) {
        path += `?${queryParams.join('&')}`;
    }
    await fetchNotehubApi(path, 'POST', { filename });
    return { message: 'Firmware update queued successfully' };
}
async function cancelFirmwareUpdate(fleetUID, deviceUID) {
    let path = `/v1/projects/${NOTEHUB_PROJECT_UID}/dfu/host/cancel`;
    const queryParams = [];
    if (fleetUID) {
        queryParams.push(`fleetUID=${encodeURIComponent(fleetUID)}`);
    }
    if (deviceUID) {
        queryParams.push(`deviceUID=${encodeURIComponent(deviceUID)}`);
    }
    if (queryParams.length > 0) {
        path += `?${queryParams.join('&')}`;
    }
    await fetchNotehubApi(path, 'POST');
    return { message: 'Firmware update cancelled' };
}
async function getDfuStatus() {
    const result = await fetchNotehubApi(`/v1/projects/${NOTEHUB_PROJECT_UID}/dfu/host/status`);
    return result;
}
async function handler(event) {
    console.log('Event:', JSON.stringify(event, null, 2));
    const method = event.requestContext.http.method;
    const path = event.rawPath;
    // Handle OPTIONS for CORS
    if (method === 'OPTIONS') {
        return { statusCode: 200, headers, body: '' };
    }
    // All firmware endpoints require admin access
    if (!isAdmin(event)) {
        return {
            statusCode: 403,
            headers,
            body: JSON.stringify({ error: 'Admin access required' }),
        };
    }
    try {
        // GET /v1/firmware - List available host firmware
        if (method === 'GET' && path === '/v1/firmware') {
            const firmware = await getHostFirmware();
            // Debug: log raw firmware response
            console.log('Raw firmware response:', JSON.stringify(firmware, null, 2));
            return {
                statusCode: 200,
                headers,
                body: JSON.stringify({
                    firmware: firmware.map(f => {
                        // Extract version string from version object if needed
                        let versionStr;
                        if (typeof f.version === 'string') {
                            versionStr = f.version;
                        }
                        else if (f.version && typeof f.version === 'object') {
                            const vObj = f.version;
                            versionStr = vObj.version;
                        }
                        // Convert Unix timestamp to ISO date string
                        // Notehub returns created as a Unix timestamp string like "1766937920"
                        let dateValue;
                        const rawDate = f.created || f.uploaded || f.modified;
                        if (rawDate) {
                            const timestamp = parseInt(String(rawDate), 10);
                            if (!isNaN(timestamp)) {
                                // Unix timestamp - convert to ISO string
                                dateValue = new Date(timestamp * 1000).toISOString();
                            }
                            else {
                                // Already an ISO string or other format
                                dateValue = String(rawDate);
                            }
                        }
                        // Try all possible size field names
                        const sizeValue = f.length || f.size;
                        return {
                            filename: f.filename,
                            version: versionStr,
                            created: dateValue,
                            type: f.type,
                            target: f.target,
                            md5: f.md5,
                            size: sizeValue,
                        };
                    }),
                }),
            };
        }
        // GET /v1/firmware/status - Get DFU status
        if (method === 'GET' && path === '/v1/firmware/status') {
            const status = await getDfuStatus();
            // Debug: log raw DFU status response
            console.log('Raw DFU status response:', JSON.stringify(status, null, 2));
            return {
                statusCode: 200,
                headers,
                body: JSON.stringify({
                    firmware_type: status.firmware_type || 'host',
                    devices: (status.devices || []).map(d => {
                        // Extract current version - it's an object with version property
                        let currentVersion;
                        if (typeof d.current === 'string') {
                            currentVersion = d.current;
                        }
                        else if (d.current && typeof d.current === 'object') {
                            currentVersion = d.current.version;
                        }
                        // Status is an object with requested_version, current_version, updates, etc.
                        let requestedVersion;
                        let statusPhase;
                        let initiated;
                        let updates;
                        if (d.status && typeof d.status === 'object') {
                            const statusObj = d.status;
                            requestedVersion = statusObj.requested_version;
                            initiated = statusObj.initiated;
                            // Get the latest update's phase as the current status
                            if (statusObj.updates && statusObj.updates.length > 0) {
                                const latestUpdate = statusObj.updates[0]; // First is most recent
                                statusPhase = latestUpdate.phase || latestUpdate.description;
                                // Map updates to our format
                                updates = statusObj.updates.map(u => ({
                                    when: u.datetime || '',
                                    status: u.phase || u.status || '',
                                }));
                            }
                        }
                        else if (typeof d.status === 'string') {
                            statusPhase = d.status;
                        }
                        return {
                            device_uid: d.device_uid,
                            serial_number: d.sn,
                            current_version: currentVersion,
                            requested_version: requestedVersion,
                            status: statusPhase,
                            began: initiated || d.began,
                            updates: updates || d.updates,
                        };
                    }),
                }),
            };
        }
        // POST /v1/firmware/update - Queue firmware update
        if (method === 'POST' && path === '/v1/firmware/update') {
            const body = event.body ? JSON.parse(event.body) : {};
            const { filename, fleetUID, deviceUID } = body;
            if (!filename) {
                return {
                    statusCode: 400,
                    headers,
                    body: JSON.stringify({ error: 'filename is required' }),
                };
            }
            const result = await queueFirmwareUpdate(filename, fleetUID, deviceUID);
            return {
                statusCode: 200,
                headers,
                body: JSON.stringify(result),
            };
        }
        // POST /v1/firmware/cancel - Cancel firmware update
        if (method === 'POST' && path === '/v1/firmware/cancel') {
            const body = event.body ? JSON.parse(event.body) : {};
            const { fleetUID, deviceUID } = body;
            const result = await cancelFirmwareUpdate(fleetUID, deviceUID);
            return {
                statusCode: 200,
                headers,
                body: JSON.stringify(result),
            };
        }
        return {
            statusCode: 404,
            headers,
            body: JSON.stringify({ error: 'Not found' }),
        };
    }
    catch (error) {
        console.error('Error:', error);
        const errorMessage = error instanceof Error ? error.message : 'Internal server error';
        return {
            statusCode: 500,
            headers,
            body: JSON.stringify({ error: errorMessage }),
        };
    }
}
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9sYW1iZGEvYXBpLWZpcm13YXJlL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRzs7O0FBRUgsNEVBQThGO0FBRzlGLE1BQU0sYUFBYSxHQUFHLElBQUksNkNBQW9CLENBQUMsRUFBRSxDQUFDLENBQUM7QUFFbkQsTUFBTSxtQkFBbUIsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixJQUFJLEVBQUUsQ0FBQztBQUNsRSxNQUFNLGtCQUFrQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLElBQUksRUFBRSxDQUFDO0FBRWhFLE1BQU0sT0FBTyxHQUFHO0lBQ2QsY0FBYyxFQUFFLGtCQUFrQjtJQUNsQyw2QkFBNkIsRUFBRSxHQUFHO0lBQ2xDLDhCQUE4QixFQUFFLDRCQUE0QjtJQUM1RCw4QkFBOEIsRUFBRSxrQkFBa0I7Q0FDbkQsQ0FBQztBQUVGLHFEQUFxRDtBQUNyRCxJQUFJLFdBQVcsR0FBa0IsSUFBSSxDQUFDO0FBRXRDLEtBQUssVUFBVSxlQUFlO0lBQzVCLElBQUksV0FBVyxFQUFFLENBQUM7UUFDaEIsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUVELE1BQU0sT0FBTyxHQUFHLElBQUksOENBQXFCLENBQUMsRUFBRSxRQUFRLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO0lBQzVFLE1BQU0sUUFBUSxHQUFHLE1BQU0sYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUVuRCxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzNCLE1BQU0sSUFBSSxLQUFLLENBQUMsdUNBQXVDLENBQUMsQ0FBQztJQUMzRCxDQUFDO0lBRUQsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDakQsV0FBVyxHQUFHLE1BQU0s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QUNILENBQUM7QUExTEQsMEJBMExDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBUEkgRmlybXdhcmUgTGFtYmRhXG4gKlxuICogSGFuZGxlcyBob3N0IGZpcm13YXJlIG1hbmFnZW1lbnQgb3BlcmF0aW9ucyB2aWEgTm90ZWh1YiBBUEkuXG4gKiBBbGwgZW5kcG9pbnRzIGFyZSBhZG1pbi1vbmx5LlxuICovXG5cbmltcG9ydCB7IFNlY3JldHNNYW5hZ2VyQ2xpZW50LCBHZXRTZWNyZXRWYWx1ZUNvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtc2VjcmV0cy1tYW5hZ2VyJztcbmltcG9ydCB0eXBlIHsgQVBJR2F0ZXdheVByb3h5RXZlbnRWMldpdGhKV1RBdXRob3JpemVyLCBBUElHYXRld2F5UHJveHlSZXN1bHRWMiB9IGZyb20gJ2F3cy1sYW1iZGEnO1xuXG5jb25zdCBzZWNyZXRzQ2xpZW50ID0gbmV3IFNlY3JldHNNYW5hZ2VyQ2xpZW50KHt9KTtcblxuY29uc3QgTk9URUhVQl9QUk9KRUNUX1VJRCA9IHByb2Nlc3MuZW52Lk5PVEVIVUJfUFJPSkVDVF9VSUQgfHwgJyc7XG5jb25zdCBOT1RFSFVCX1NFQ1JFVF9BUk4gPSBwcm9jZXNzLmVudi5OT1RFSFVCX1NFQ1JFVF9BUk4gfHwgJyc7XG5cbmNvbnN0IGhlYWRlcnMgPSB7XG4gICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKicsXG4gICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJzogJ0NvbnRlbnQtVHlwZSxBdXRob3JpemF0aW9uJyxcbiAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnOiAnR0VULFBPU1QsT1BUSU9OUycsXG59O1xuXG4vLyBDYWNoZSB0aGUgdG9rZW4gdG8gYXZvaWQgZmV0Y2hpbmcgb24gZXZlcnkgcmVxdWVzdFxubGV0IGNhY2hlZFRva2VuOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0Tm90ZWh1YlRva2VuKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gIGlmIChjYWNoZWRUb2tlbikge1xuICAgIHJldHVybiBjYWNoZWRUb2tlbjtcbiAgfVxuXG4gIGNvbnN0IGNvbW1hbmQgPSBuZXcgR2V0U2VjcmV0VmFsdWVDb21tYW5kKHsgU2VjcmV0SWQ6IE5PVEVIVUJfU0VDUkVUX0FSTiB9KTtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzZWNyZXRzQ2xpZW50LnNlbmQoY29tbWFuZCk7XG5cbiAgaWYgKCFyZXNwb25zZS5TZWNyZXRTdHJpbmcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdGVodWIgQVBJIHRva2VuIG5vdCBmb3VuZCBpbiBzZWNyZXQnKTtcbiAgfVxuXG4gIGNvbnN0IHNlY3JldCA9IEpTT04ucGFyc2UocmVzcG9uc2UuU2VjcmV0U3RyaW5nKTtcbiAgY2FjaGVkVG9rZW4gPSBzZWNyZXQudG9rZW47XG5cbiAgaWYgKCFjYWNoZWRUb2tlbikge1xuICAgIHRocm93IG5ldyBFcnJvcignVG9rZW4gZmllbGQgbm90IGZvdW5kIGluIHNlY3JldCcpO1xuICB9XG5cbiAgcmV0dXJuIGNhY2hlZFRva2VuO1xufVxuXG5mdW5jdGlvbiBpc0FkbWluKGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudFYyV2l0aEpXVEF1dGhvcml6ZXIpOiBib29sZWFuIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjbGFpbXMgPSBldmVudC5yZXF1ZXN0Q29udGV4dD8uYXV0aG9yaXplcj8uand0Py5jbGFpbXM7XG4gICAgaWYgKCFjbGFpbXMpIHJldHVybiBmYWxzZTtcblxuICAgIGNvbnN0IGdyb3VwcyA9IGNsYWltc1snY29nbml0bzpncm91cHMnXTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShncm91cHMpKSB7XG4gICAgICByZXR1cm4gZ3JvdXBzLmluY2x1ZGVzKCdBZG1pbicpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGdyb3VwcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBncm91cHMgPT09ICdBZG1pbicgfHwgZ3JvdXBzLmluY2x1ZGVzKCdBZG1pbicpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5pbnRlcmZhY2UgSG9zdEZpcm13YXJlVmVyc2lvbiB7XG4gIHZlcnNpb24/OiBzdHJpbmc7XG4gIG9yZ2FuaXphdGlvbj86IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIHByb2R1Y3Q/OiBzdHJpbmc7XG4gIGJ1aWx0Pzogc3RyaW5nO1xuICBidWlsZGVyPzogc3RyaW5nO1xufVxuXG4vLyBOb3RlaHViIGZpcm13YXJlIHJlc3BvbnNlIC0gaGFuZGxlIHZhcmlvdXMgZmllbGQgbmFtZSBwb3NzaWJpbGl0aWVzXG5pbnRlcmZhY2UgSG9zdEZpcm13YXJlIHtcbiAgZmlsZW5hbWU6IHN0cmluZztcbiAgdmVyc2lvbj86IHN0cmluZyB8IEhvc3RGaXJtd2FyZVZlcnNpb247XG4gIGNyZWF0ZWQ/OiBzdHJpbmc7XG4gIHVwbG9hZGVkPzogc3RyaW5nO1xuICBtb2RpZmllZD86IHN0cmluZztcbiAgdHlwZTogc3RyaW5nO1xuICB0YXJnZXQ/OiBzdHJpbmc7XG4gIG1kNT86IHN0cmluZztcbiAgbGVuZ3RoPzogbnVtYmVyO1xuICBzaXplPzogbnVtYmVyO1xuICAvLyBBZGRpdGlvbmFsIGZpZWxkcyB0aGF0IG1pZ2h0IGJlIHJldHVybmVkXG4gIFtrZXk6IHN0cmluZ106IHVua25vd247XG59XG5cbmludGVyZmFjZSBEZnVVcGRhdGVFbnRyeSB7XG4gIHN0YXR1cz86IHN0cmluZztcbiAgcGhhc2U/OiBzdHJpbmc7XG4gIGRhdGV0aW1lPzogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIERmdURldmljZVN0YXR1c0luZm8ge1xuICByZXF1ZXN0ZWRfdmVyc2lvbj86IHN0cmluZztcbiAgY3VycmVudF92ZXJzaW9uPzogc3RyaW5nO1xuICBpbml0aWF0ZWQ/OiBzdHJpbmc7XG4gIHVwZGF0ZXM/OiBEZnVVcGRhdGVFbnRyeVtdO1xufVxuXG5pbnRlcmZhY2UgRGZ1Q3VycmVudFZlcnNpb24ge1xuICB2ZXJzaW9uPzogc3RyaW5nO1xuICBvcmdhbml6YXRpb24/OiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBwcm9kdWN0Pzogc3RyaW5nO1xuICBidWlsdD86IHN0cmluZztcbiAgYnVpbGRlcj86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIERmdURldmljZVN0YXR1cyB7XG4gIGRldmljZV91aWQ6IHN0cmluZztcbiAgc24/OiBzdHJpbmc7XG4gIGN1cnJlbnQ/OiBzdHJpbmcgfCBEZnVDdXJyZW50VmVyc2lvbjtcbiAgcmVxdWVzdGVkPzogc3RyaW5nO1xuICBzdGF0dXM/OiBzdHJpbmcgfCBEZnVEZXZpY2VTdGF0dXNJbmZvO1xuICBiZWdhbj86IHN0cmluZztcbiAgdXBkYXRlcz86IERmdVVwZGF0ZUVudHJ5W107XG59XG5cbmludGVyZmFjZSBEZnVTdGF0dXNSZXNwb25zZSB7XG4gIGZpcm13YXJlX3R5cGU/OiBzdHJpbmc7XG4gIGRldmljZXM/OiBEZnVEZXZpY2VTdGF0dXNbXTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hOb3RlaHViQXBpPFQ+KFxuICBwYXRoOiBzdHJpbmcsXG4gIG1ldGhvZDogc3RyaW5nID0gJ0dFVCcsXG4gIGJvZHk/OiB1bmtub3duXG4pOiBQcm9taXNlPFQ+IHtcbiAgY29uc3QgdG9rZW4gPSBhd2FpdCBnZXROb3RlaHViVG9rZW4oKTtcblxuICBjb25zdCBvcHRpb25zOiBSZXF1ZXN0SW5pdCA9IHtcbiAgICBtZXRob2QsXG4gICAgaGVhZGVyczoge1xuICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dG9rZW59YCxcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgfSxcbiAgfTtcblxuICBpZiAoYm9keSAmJiAobWV0aG9kID09PSAnUE9TVCcgfHwgbWV0aG9kID09PSAnUFVUJykpIHtcbiAgICBvcHRpb25zLmJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgfVxuXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHBzOi8vYXBpLm5vdGVmaWxlLm5ldCR7cGF0aH1gLCBvcHRpb25zKTtcblxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgIHRocm93IG5ldyBFcnJvcihgTm90ZWh1YiBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3Jlc3BvbnNlLnN0YXR1c1RleHR9IC0gJHtlcnJvclRleHR9YCk7XG4gIH1cblxuICAvLyBIYW5kbGUgZW1wdHkgcmVzcG9uc2VzIChzb21lIFBPU1QgZW5kcG9pbnRzIHJldHVybiBlbXB0eSBib2R5KVxuICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICBpZiAoIXRleHQpIHtcbiAgICByZXR1cm4ge30gYXMgVDtcbiAgfVxuXG4gIHJldHVybiBKU09OLnBhcnNlKHRleHQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRIb3N0RmlybXdhcmUoKTogUHJvbWlzZTxIb3N0RmlybXdhcmVbXT4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCBmZXRjaE5vdGVodWJBcGk8SG9zdEZpcm13YXJlW10+KFxuICAgIGAvdjEvcHJvamVjdHMvJHtOT1RFSFVCX1BST0pFQ1RfVUlEfS9maXJtd2FyZT9maXJtd2FyZVR5cGU9aG9zdGBcbiAgKTtcbiAgcmV0dXJuIHJlc3VsdCB8fCBbXTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcXVldWVGaXJtd2FyZVVwZGF0ZShcbiAgZmlsZW5hbWU6IHN0cmluZyxcbiAgZmxlZXRVSUQ/OiBzdHJpbmcsXG4gIGRldmljZVVJRD86IHN0cmluZ1xuKTogUHJvbWlzZTx7IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gIGxldCBwYXRoID0gYC92MS9wcm9qZWN0cy8ke05PVEVIVUJfUFJPSkVDVF9VSUR9L2RmdS9ob3N0L3VwZGF0ZWA7XG4gIGNvbnN0IHF1ZXJ5UGFyYW1zOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGlmIChmbGVldFVJRCkge1xuICAgIHF1ZXJ5UGFyYW1zLnB1c2goYGZsZWV0VUlEPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGZsZWV0VUlEKX1gKTtcbiAgfVxuICBpZiAoZGV2aWNlVUlEKSB7XG4gICAgcXVlcnlQYXJhbXMucHVzaChgZGV2aWNlVUlEPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGRldmljZVVJRCl9YCk7XG4gIH1cblxuICBpZiAocXVlcnlQYXJhbXMubGVuZ3RoID4gMCkge1xuICAgIHBhdGggKz0gYD8ke3F1ZXJ5UGFyYW1zLmpvaW4oJyYnKX1gO1xuICB9XG5cbiAgYXdhaXQgZmV0Y2hOb3RlaHViQXBpPHVua25vd24+KHBhdGgsICdQT1NUJywgeyBmaWxlbmFtZSB9KTtcblxuICByZXR1cm4geyBtZXNzYWdlOiAnRmlybXdhcmUgdXBkYXRlIHF1ZXVlZCBzdWNjZXNzZnVsbHknIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNhbmNlbEZpcm13YXJlVXBkYXRlKFxuICBmbGVldFVJRD86IHN0cmluZyxcbiAgZGV2aWNlVUlEPzogc3RyaW5nXG4pOiBQcm9taXNlPHsgbWVzc2FnZTogc3RyaW5nIH0+IHtcbiAgbGV0IHBhdGggPSBgL3YxL3Byb2plY3RzLyR7Tk9URUhVQl9QUk9KRUNUX1VJRH0vZGZ1L2hvc3QvY2FuY2VsYDtcbiAgY29uc3QgcXVlcnlQYXJhbXM6IHN0cmluZ1tdID0gW107XG5cbiAgaWYgKGZsZWV0VUlEKSB7XG4gICAgcXVlcnlQYXJhbXMucHVzaChgZmxlZXRVSUQ9JHtlbmNvZGVVUklDb21wb25lbnQoZmxlZXRVSUQpfWApO1xuICB9XG4gIGlmIChkZXZpY2VVSUQpIHtcbiAgICBxdWVyeVBhcmFtcy5wdXNoKGBkZXZpY2VVSUQ9JHtlbmNvZGVVUklDb21wb25lbnQoZGV2aWNlVUlEKX1gKTtcbiAgfVxuXG4gIGlmIChxdWVyeVBhcmFtcy5sZW5ndGggPiAwKSB7XG4gICAgcGF0aCArPSBgPyR7cXVlcnlQYXJhbXMuam9pbignJicpfWA7XG4gIH1cblxuICBhd2FpdCBmZXRjaE5vdGVodWJBcGk8dW5rbm93bj4ocGF0aCwgJ1BPU1QnKTtcblxuICByZXR1cm4geyBtZXNzYWdlOiAnRmlybXdhcmUgdXBkYXRlIGNhbmNlbGxlZCcgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RGZ1U3RhdHVzKCk6IFByb21pc2U8RGZ1U3RhdHVzUmVzcG9uc2U+IHtcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZmV0Y2hOb3RlaHViQXBpPERmdVN0YXR1c1Jlc3BvbnNlPihcbiAgICBgL3YxL3Byb2plY3RzLyR7Tk9URUhVQl9QUk9KRUNUX1VJRH0vZGZ1L2hvc3Qvc3RhdHVzYFxuICApO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihldmVudDogQVBJR2F0ZXdheVByb3h5RXZlbnRWMldpdGhKV1RBdXRob3JpemVyKTogUHJvbWlzZTxBUElHYXRld2F5UHJveHlSZXN1bHRWMj4ge1xuICBjb25zb2xlLmxvZygnRXZlbnQ6JywgSlNPTi5zdHJpbmdpZnkoZXZlbnQsIG51bGwsIDIpKTtcblxuICBjb25zdCBtZXRob2QgPSBldmVudC5yZXF1ZXN0Q29udGV4dC5odHRwLm1ldGhvZDtcbiAgY29uc3QgcGF0aCA9IGV2ZW50LnJhd1BhdGg7XG5cbiAgLy8gSGFuZGxlIE9QVElPTlMgZm9yIENPUlNcbiAgaWYgKG1ldGhvZCA9PT0gJ09QVElPTlMnKSB7XG4gICAgcmV0dXJuIHsgc3RhdHVzQ29kZTogMjAwLCBoZWFkZXJzLCBib2R5OiAnJyB9O1xuICB9XG5cbiAgLy8gQWxsIGZpcm13YXJlIGVuZHBvaW50cyByZXF1aXJlIGFkbWluIGFjY2Vzc1xuICBpZiAoIWlzQWRtaW4oZXZlbnQpKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXR1c0NvZGU6IDQwMyxcbiAgICAgIGhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVycm9yOiAnQWRtaW4gYWNjZXNzIHJlcXVpcmVkJyB9KSxcbiAgICB9O1xuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBHRVQgL3YxL2Zpcm13YXJlIC0gTGlzdCBhdmFpbGFibGUgaG9zdCBmaXJtd2FyZVxuICAgIGlmIChtZXRob2QgPT09ICdHRVQnICYmIHBhdGggPT09ICcvdjEvZmlybXdhcmUnKSB7XG4gICAgICBjb25zdCBmaXJtd2FyZSA9IGF3YWl0IGdldEhvc3RGaXJtd2FyZSgpO1xuXG4gICAgICAvLyBEZWJ1ZzogbG9nIHJhdyBmaXJtd2FyZSByZXNwb25zZVxuICAgICAgY29uc29sZS5sb2coJ1JhdyBmaXJtd2FyZSByZXNwb25zZTonLCBKU09OLnN0cmluZ2lmeShmaXJtd2FyZSwgbnVsbCwgMikpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgICAgIGhlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBmaXJtd2FyZTogZmlybXdhcmUubWFwKGYgPT4ge1xuICAgICAgICAgICAgLy8gRXh0cmFjdCB2ZXJzaW9uIHN0cmluZyBmcm9tIHZlcnNpb24gb2JqZWN0IGlmIG5lZWRlZFxuICAgICAgICAgICAgbGV0IHZlcnNpb25TdHI6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZi52ZXJzaW9uID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICB2ZXJzaW9uU3RyID0gZi52ZXJzaW9uO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmLnZlcnNpb24gJiYgdHlwZW9mIGYudmVyc2lvbiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgY29uc3Qgdk9iaiA9IGYudmVyc2lvbiBhcyBIb3N0RmlybXdhcmVWZXJzaW9uO1xuICAgICAgICAgICAgICB2ZXJzaW9uU3RyID0gdk9iai52ZXJzaW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDb252ZXJ0IFVuaXggdGltZXN0YW1wIHRvIElTTyBkYXRlIHN0cmluZ1xuICAgICAgICAgICAgLy8gTm90ZWh1YiByZXR1cm5zIGNyZWF0ZWQgYXMgYSBVbml4IHRpbWVzdGFtcCBzdHJpbmcgbGlrZSBcIjE3NjY5Mzc5MjBcIlxuICAgICAgICAgICAgbGV0IGRhdGVWYWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgICAgICAgY29uc3QgcmF3RGF0ZSA9IGYuY3JlYXRlZCB8fCBmLnVwbG9hZGVkIHx8IGYubW9kaWZpZWQ7XG4gICAgICAgICAgICBpZiAocmF3RGF0ZSkge1xuICAgICAgICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBwYXJzZUludChTdHJpbmcocmF3RGF0ZSksIDEwKTtcbiAgICAgICAgICAgICAgaWYgKCFpc05hTih0aW1lc3RhbXApKSB7XG4gICAgICAgICAgICAgICAgLy8gVW5peCB0aW1lc3RhbXAgLSBjb252ZXJ0IHRvIElTTyBzdHJpbmdcbiAgICAgICAgICAgICAgICBkYXRlVmFsdWUgPSBuZXcgRGF0ZSh0aW1lc3RhbXAgKiAxMDAwKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEFscmVhZHkgYW4gSVNPIHN0cmluZyBvciBvdGhlciBmb3JtYXRcbiAgICAgICAgICAgICAgICBkYXRlVmFsdWUgPSBTdHJpbmcocmF3RGF0ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVHJ5IGFsbCBwb3NzaWJsZSBzaXplIGZpZWxkIG5hbWVzXG4gICAgICAgICAgICBjb25zdCBzaXplVmFsdWUgPSBmLmxlbmd0aCB8fCBmLnNpemU7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGZpbGVuYW1lOiBmLmZpbGVuYW1lLFxuICAgICAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uU3RyLFxuICAgICAgICAgICAgICBjcmVhdGVkOiBkYXRlVmFsdWUsXG4gICAgICAgICAgICAgIHR5cGU6IGYudHlwZSxcbiAgICAgICAgICAgICAgdGFyZ2V0OiBmLnRhcmdldCxcbiAgICAgICAgICAgICAgbWQ1OiBmLm1kNSxcbiAgICAgICAgICAgICAgc2l6ZTogc2l6ZVZhbHVlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEdFVCAvdjEvZmlybXdhcmUvc3RhdHVzIC0gR2V0IERGVSBzdGF0dXNcbiAgICBpZiAobWV0aG9kID09PSAnR0VUJyAmJiBwYXRoID09PSAnL3YxL2Zpcm13YXJlL3N0YXR1cycpIHtcbiAgICAgIGNvbnN0IHN0YXR1cyA9IGF3YWl0IGdldERmdVN0YXR1cygpO1xuXG4gICAgICAvLyBEZWJ1ZzogbG9nIHJhdyBERlUgc3RhdHVzIHJlc3BvbnNlXG4gICAgICBjb25zb2xlLmxvZygnUmF3IERGVSBzdGF0dXMgcmVzcG9uc2U6JywgSlNPTi5zdHJpbmdpZnkoc3RhdHVzLCBudWxsLCAyKSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1c0NvZGU6IDIwMCxcbiAgICAgICAgaGVhZGVycyxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGZpcm13YXJlX3R5cGU6IHN0YXR1cy5maXJtd2FyZV90eXBlIHx8ICdob3N0JyxcbiAgICAgICAgICBkZXZpY2VzOiAoc3RhdHVzLmRldmljZXMgfHwgW10pLm1hcChkID0+IHtcbiAgICAgICAgICAgIC8vIEV4dHJhY3QgY3VycmVudCB2ZXJzaW9uIC0gaXQncyBhbiBvYmplY3Qgd2l0aCB2ZXJzaW9uIHByb3BlcnR5XG4gICAgICAgICAgICBsZXQgY3VycmVudFZlcnNpb246IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZC5jdXJyZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICBjdXJyZW50VmVyc2lvbiA9IGQuY3VycmVudDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZC5jdXJyZW50ICYmIHR5cGVvZiBkLmN1cnJlbnQgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRWZXJzaW9uID0gZC5jdXJyZW50LnZlcnNpb247XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFN0YXR1cyBpcyBhbiBvYmplY3Qgd2l0aCByZXF1ZXN0ZWRfdmVyc2lvbiwgY3VycmVudF92ZXJzaW9uLCB1cGRhdGVzLCBldGMuXG4gICAgICAgICAgICBsZXQgcmVxdWVzdGVkVmVyc2lvbjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgICAgICAgbGV0IHN0YXR1c1BoYXNlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgICBsZXQgaW5pdGlhdGVkOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgICBsZXQgdXBkYXRlczogQXJyYXk8eyB3aGVuOiBzdHJpbmc7IHN0YXR1czogc3RyaW5nIH0+IHwgdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICBpZiAoZC5zdGF0dXMgJiYgdHlwZW9mIGQuc3RhdHVzID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICBjb25zdCBzdGF0dXNPYmogPSBkLnN0YXR1cyBhcyBEZnVEZXZpY2VTdGF0dXNJbmZvO1xuICAgICAgICAgICAgICByZXF1ZXN0ZWRWZXJzaW9uID0gc3RhdHVzT2JqLnJlcXVlc3RlZF92ZXJzaW9uO1xuICAgICAgICAgICAgICBpbml0aWF0ZWQgPSBzdGF0dXNPYmouaW5pdGlhdGVkO1xuXG4gICAgICAgICAgICAgIC8vIEdldCB0aGUgbGF0ZXN0IHVwZGF0ZSdzIHBoYXNlIGFzIHRoZSBjdXJyZW50IHN0YXR1c1xuICAgICAgICAgICAgICBpZiAoc3RhdHVzT2JqLnVwZGF0ZXMgJiYgc3RhdHVzT2JqLnVwZGF0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxhdGVzdFVwZGF0ZSA9IHN0YXR1c09iai51cGRhdGVzWzBdOyAvLyBGaXJzdCBpcyBtb3N0IHJlY2VudFxuICAgICAgICAgICAgICAgIHN0YXR1c1BoYXNlID0gbGF0ZXN0VXBkYXRlLnBoYXNlIHx8IGxhdGVzdFVwZGF0ZS5kZXNjcmlwdGlvbjtcblxuICAgICAgICAgICAgICAgIC8vIE1hcCB1cGRhdGVzIHRvIG91ciBmb3JtYXRcbiAgICAgICAgICAgICAgICB1cGRhdGVzID0gc3RhdHVzT2JqLnVwZGF0ZXMubWFwKHUgPT4gKHtcbiAgICAgICAgICAgICAgICAgIHdoZW46IHUuZGF0ZXRpbWUgfHwgJycsXG4gICAgICAgICAgICAgICAgICBzdGF0dXM6IHUucGhhc2UgfHwgdS5zdGF0dXMgfHwgJycsXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkLnN0YXR1cyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgc3RhdHVzUGhhc2UgPSBkLnN0YXR1cztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgZGV2aWNlX3VpZDogZC5kZXZpY2VfdWlkLFxuICAgICAgICAgICAgICBzZXJpYWxfbnVtYmVyOiBkLnNuLFxuICAgICAgICAgICAgICBjdXJyZW50X3ZlcnNpb246IGN1cnJlbnRWZXJzaW9uLFxuICAgICAgICAgICAgICByZXF1ZXN0ZWRfdmVyc2lvbjogcmVxdWVzdGVkVmVyc2lvbixcbiAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXNQaGFzZSxcbiAgICAgICAgICAgICAgYmVnYW46IGluaXRpYXRlZCB8fCBkLmJlZ2FuLFxuICAgICAgICAgICAgICB1cGRhdGVzOiB1cGRhdGVzIHx8IGQudXBkYXRlcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBQT1NUIC92MS9maXJtd2FyZS91cGRhdGUgLSBRdWV1ZSBmaXJtd2FyZSB1cGRhdGVcbiAgICBpZiAobWV0aG9kID09PSAnUE9TVCcgJiYgcGF0aCA9PT0gJy92MS9maXJtd2FyZS91cGRhdGUnKSB7XG4gICAgICBjb25zdCBib2R5ID0gZXZlbnQuYm9keSA/IEpTT04ucGFyc2UoZXZlbnQuYm9keSkgOiB7fTtcbiAgICAgIGNvbnN0IHsgZmlsZW5hbWUsIGZsZWV0VUlELCBkZXZpY2VVSUQgfSA9IGJvZHk7XG5cbiAgICAgIGlmICghZmlsZW5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICAgICAgaGVhZGVycyxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVycm9yOiAnZmlsZW5hbWUgaXMgcmVxdWlyZWQnIH0pLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBxdWV1ZUZpcm13YXJlVXBkYXRlKGZpbGVuYW1lLCBmbGVldFVJRCwgZGV2aWNlVUlEKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzQ29kZTogMjAwLFxuICAgICAgICBoZWFkZXJzLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXN1bHQpLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBQT1NUIC92MS9maXJtd2FyZS9jYW5jZWwgLSBDYW5jZWwgZmlybXdhcmUgdXBkYXRlXG4gICAgaWYgKG1ldGhvZCA9PT0gJ1BPU1QnICYmIHBhdGggPT09ICcvdjEvZmlybXdhcmUvY2FuY2VsJykge1xuICAgICAgY29uc3QgYm9keSA9IGV2ZW50LmJvZHkgPyBKU09OLnBhcnNlKGV2ZW50LmJvZHkpIDoge307XG4gICAgICBjb25zdCB7IGZsZWV0VUlELCBkZXZpY2VVSUQgfSA9IGJvZHk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhbmNlbEZpcm13YXJlVXBkYXRlKGZsZWV0VUlELCBkZXZpY2VVSUQpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgICAgIGhlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3VsdCksXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogJ05vdCBmb3VuZCcgfSksXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvcjonLCBlcnJvcik7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJztcblxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXNDb2RlOiA1MDAsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogZXJyb3JNZXNzYWdlIH0pLFxuICAgIH07XG4gIH1cbn1cbiJdfQ==